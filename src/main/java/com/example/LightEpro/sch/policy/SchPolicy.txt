------------------------------------------------------------------
■ 캘린더 정책 ■
[공통]
 캘린더는 개인 캘린더와 공유 캘린더 두가지 타입이 존재한다.
 캘린더는 소유자/관리자 두가지 구성원이 존재한다.
 이떄 , 소유자의 등록된 인원이 관리자에 포함될 수 있다.
  1. 카카오 주식회사 회사의 포함된 개인인 서보인이 공유캘린더 소유자로 등록되어 있음
  2. 이떄 , 홍길동이 캘린더의 관리자로 카카오 주식회사를 등록 진행
  3. 이런 경우의 권한은 소유자와 관리자의 권한을 동시에 가지기에 , 홍길동은 상위 권한인 소유자 권한 M 을 가짐

[소유자]
 캘린더 소유자는 개인 타입의 인원이 등록 될 수 있다.
 캘린더 소유자는 M (마스터 권한) 을 갖는다.
 → 캘린더의 대한 삭제 / 수정 / 조회 권한을 갖는다.

[관리자]
 캘린더 관리자는 개인/부서/회사 타입의 인원이 등록 될 수 있다.
 캘린더의 관리자는 W (수정 권한) 을 갖는다.
 → 캘린더의 대한 수정 / 조회 권한을 갖는다.

1. 개인 캘린더
- 개인 캘린더는 소유자 구성원만 가질수 있다.
- 캘린더를 등록시에 , 해당 개인 캘린더를 등록하고자 하는 사원과 , 캘린더의 소유자 정보는 같아야 한다.
  (홍길동이 , 박정대의 개인캘린더를 생성할 수 없음 / 홍길동은 홍길동의 개인캘린더를 생성 할 수 있음)
- 해당 캘린더의 성격은 , 누군가에게 공유하는 일정이 아닌 , 본인만 열람할 수 있는 캘린더이다. (공유 하기위한 목적이 아님)

2. 공유 캘린더
- 공유 캘린더는 소유자 구성원은 필수로 가지며 , 관리자 구성원은 선택적으로 가질 수 있다. (캘린더를 구성하는 필수항목이 아님.)
- 캘린더를 등록시에 , 해당 개인 캘린더를 등록하고자 하는 사원과 , 캘린더의 소유자 정보는 같아야 한다.
  (홍길동이 , 박정대의 공유 캘린더를 생성할 수 없음 / 홍길동은 홍길동의 공유 캘린더를 생성 할 수 있음)
- 공유 캘린더의 관리자는 W 권한으로 쓰기 권한을 갖는다.
- 해당 캘린더의 성격은 , 누군가에게 나의 일정을 공유하고자 할 때 , 참여를 유도하고 확인이 필요한 경우 사용 할 수 있는 캘린더 이다. (공유 하기위한 목적)

3. 캘린더 권한 (상세)
- 캘린더 권한은 특정 캘린더에 접근하는경우, 캘린더의 소유자 및 관리자에 포함된 인원인 경우 '캘린더에 대한 권한이 존재한다' 라고 한다.
- 캘린더의 권한이 존재하는 경우 , 캘린더의 속해있는 소유자 혹은 관리자 이므로 해당 구성원이 타입에 맞는 권한을 갖는다
- 예시1) 소유자인 경우 > 캘린더 삭제, 수정, 조회 (등록 = 최초인 경우) 가 가능하다.
- 예시2) 관리자인 경우 > 캘린더 수정(소유자 변경을 제외한 캘린더 구성원 및 내용 수정), 조회 가 가능하다.

------------------------------------------------------------------
■ 일정 정책 ■
[공통]
 일정은 개인캘린더에 등록될 개인 일정과 , 공유캘린더에 등록될 공유 일정이 존재한다.
 일정은 참여자/공개범위 두가지 구성원이 존재한다.
 이떄 , 참여자에 포함된 인원이 공개범위에 포함될 수 있다. (위 캘린더의 내용과 동일)
 다만 , 권한은 참여자의 권한이 , 공개범위 인원의 권한보다 상위 권한이므로 , 수정권한을 갖는다.

[참여자]
 일정의 참여자는 수정권한을 가지는 구성원이며 , 개인 타입의 인원이 등록 될 수 있다.
 → 일정에 대한 수정 / 조회 권한을 갖는다.
 *** 특이케이스로 > 일정 등록시 , 해당 일정의 등록자가 참여자에 반드시 포함되어야 하며 , 해당 인원은 M 권한을 갖는다.
     일정의 M 권한 : 일정의 삭제/수정/조회 가능

[공개범위]
 일정의 공개범위는 조회권한을 가지는 구성원이며 , 개인/부서/회사 타입의 인원이 등록 될 수 있다.
 → 일정에 대한 조회 권한 (R) 을 갖는다.

------------------------------------------------------------------
■ 캘린더/일정 혼합 정책 ■
캘린더 권한 번외 (일정에 대한 혼합 정책)
→ 조건
  [캘린더]
  공유 캘린더명 : 카카오 주식회사 공유 캘린더 (하기 인원들이 조직도 시스템상, 카카오 주식회사 라는 회사에 속해 있는 인원이라 가정)
  공유 캘린더 소유자 : 홍길동 (개인 타입)
  공유 캘린더 관리자 : 을지문덕 (개인 타입)

  [일정]
  일정명 : 카카오 주식회사 정기 회의
  캘린더 : 카카오 주식회사 공유 캘린더
  일정 등록자 : 홍길동 (개인 타입)
  일정 참여자 : 이순신 (개인 타입)
  일정 공개범위 : 카카오 주식회사 (회사 타입)

- 위 조건과 같이 특정 캘린더에 포함된 일정에 대해 참여자 및 공개범위로 구성되어 있는 경우
여러인원의 관점이 생기는데 다음과 같이 정리할 수 있다. (여기서 말하는 여러관점은 홍길동,을지문덕,이순신 등 '카카오 주식회사 정기 회의' 일정에 대한 관점을 말한다.)

* 홍길동의 관점 : 홍길동은 해당 캘린더의 마스터 권한 즉 소유자 이므로 해당 캘린더 및 모든 일정에 대한 마스터 권한을 갖는다. (캘린더/일정 삭제,조회,등록,수정 전부 가능)
* 을지문덕의 관점 : 을지문덕은 해당 캘린더의 쓰기 권한 즉 관리자 이므로 해당 캘린더의 수정,조회 권한을 가지며 일정에서는 공개범위에 포함된 인원으로 조회 권한을 갖는다.
* 이순신의 관점 : 이순신은 해당 캘린더의 권한이 존재하지 않으며, 일정에서는 참여자로 속해있으므로 일정의 권한을 따르며, 쓰기 권한으로 일정 수정 및 조회가 가능하다.
* 카카오 주식회사에 속해있는 인원 : 캘린더에 속해있는 인원이 아니므로, 캘린더에 대한 권한이 존재하지 않으며, 일정에서는 공개범위에 속해있으므로 일정의 권한을 따르며, 조회 권한으로 일정 조회가 가능하다.

위와 같은 케이스를 통해 권한의 대한 분기처리는 다음과 같이 처리할수 있다.
1. 특정인원이 캘린더 구성원에 속해있는가 ?
 1.1) 소유자/관리자에 속해있다.
  1.1.1) 소유자인 경우
   1.1.1.1) 캘린더 및 속해있는 일정에 대해 마스터 권한을 갖는다 (일정에 참여자,공개범위로 포함되어 있어도 마스터 권한을 갖는다.)
  1.1.2) 관리자인 경우 (캘린더에 대한 수정/조회 권한을 갖는다. 일정은 해당 일정에 참여자 공개범위에 포함되어 있는 인원인지에 대하여 일정에 대한 권한은 따로 갖는다.)
    1.1.2.1) 일정의 등록자인 경우 : 일정에 마스터 권한을 갖는다.
    1.1.2.2) 일정의 등록자인 경우 : 일정에 쓰기 권한을 갖는다.
    1.1.2.3) 일정의 등록자인 경우 : 일정에 조회 권한을 갖는다.
 1.2) 소유자/관리자에 속해있지않다.
  1.2.1) 일정의 등록자인 경우 : 일정에 마스터 권한을 갖는다.
  1.2.2) 일정의 참여자인 경우 : 일정에 쓰기 권한을 갖는다.
  1.2.3) 일정의 공개범위인 경우 : 일정에 조회 권한을 갖는다.

상세 설명 1) 디테일적으로 들어가자면, 캘린더에 구성원으로서 소유자인 경우 부가적인 캘린더 관리자 및 일정의 등록자 참여자 공개범위에 속해있는지에 대한 판단은 필요없다.
이유는, 캘린더의 소유자인 경우, 캘린더에 마스터권한임과 동시에 해당 캘린더에 속한 모든 일정에 대한 마스터 권한을 가지기 떄문이다.
마스터 권한을 가지는 경우, 캘린더 수정 페이지에서의 캘린더 수정가능하며 , 일정 수정페이지 에서의 캘린더 변경또한 가능하다. (같은 캘린더 변경이라는 문장을 쓰지만 , 의미가 다른 문장이다.)

상세 설명 2) 캘린더의 관리자인 경우, 캘린더 수정시에는 일정 구성원에 포함되어 있는지 확인할 필요가 없다. 캘린더에대한 수정만 진행할떄는 캘린더 구성원에 포함되어 있는지만 확인하면 캘린더 수정이 가능하다
상세 설명 3) 다만 일정에 대한 권한을 확인시에는 캘린더의 권한또한 확인해야 한다. 캘린더의 소유자 혹은 관리자에 속해있는 경우, 기본적으로 조회권한은 디폴트로 가지고 가게 된다.
여기서 캘린더의 소유자가 아닌 관리자인 경우는 일정에 대한 권한을 확인하기 위해 일정 구성원으로 어떤 타입으로 속해있는지 확인하여 최종적인 일정에 대한 권한을 도출 할 수 있다.

상세 설명 4) 캘린더에서 소유자, 관리자로 같은 인원이 속해 있는 경우 > 상위 권한인 소유자 권한을 따른다.
상세 설명 5) 일정에서 등록자,참여자,공개범위 같은 인원이 속해있는경우 등록자(마스터)>참여자(쓰기)>공개범위(읽기) 권한을 가지게 된다.
상세 설명 5_1) 등록자 : 서보인 / 참여자 : 서보인 / 공개범위 : 서보인 인 경우 등록자의 권한이 우선시 된다.
상세 설명 5_2) 참여자 : 서보인 / 공개범위 : 서보인 인 경우 참여자의 권한이 우선시 된다.

[위 내용 쿼리 테스트 예시 > 추가수정 필요]
-- 캘린더 구성원에 속해있는 인원인가 ?
SELECT IFNULL(MIN(TSCU.CAL_PARTITION_TYPE), 0) -- 0/100/200
FROM T_SC_CAL TSC
         INNER JOIN T_SC_CAL_USER TSCU
                    ON TSC.CAL_SEQ = TSCU.CAL_SEQ
                        AND TSC.CAL_SEQ = 5
WHERE 1 = 1
  AND (TSCU.CDE_SEQ = 1 AND TSCU.CDE_TYPE = 'C' OR
       TSCU.CDE_SEQ = 1 AND TSCU.CDE_TYPE = 'D' OR
       TSCU.CDE_SEQ = 1 AND TSCU.CDE_TYPE = 'I')
  AND TSC.USE_YND = 'Y'
  AND TSCU.USE_YND = 'Y';

-- 일정 구성원에 속해 있는 인원인가 ?
SELECT IFNULL(MIN(TSSU.SCH_PARTITION_TYPE), 0) -- -- 0/10/20
FROM T_SC_SCH TSS
         INNER JOIN T_SC_SCH_USER TSSU
                    ON TSS.SCHM_SEQ = TSSU.SCHM_SEQ
                        AND TSS.SCH_SEQ = TSSU.SCH_SEQ
                        AND TSS.SCHM_SEQ = 1
                        AND TSS.SCH_SEQ = 1
WHERE 1 = 1
  AND (TSSU.CDE_SEQ = 1 AND TSSU.CDE_TYPE = 'C' OR
       TSSU.CDE_SEQ = 1 AND TSSU.CDE_TYPE = 'D' OR
       TSSU.CDE_SEQ = 1 AND TSSU.CDE_TYPE = 'I')
  AND TSS.USE_YND = 'Y'
  AND TSSU.USE_YND = 'Y';

------------------------------------------------------------------
■ 반복일정 정책 ■
TODO 확립된 정책 필요 (디비상의 컬럼 및 전반적인 로직이 변경되어야 할 필요성이 있음.)