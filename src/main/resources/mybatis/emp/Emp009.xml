<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.LightEpro.emp.mapper.EmpMapper009">
    <select id="selectCompanies" resultType="com.example.LightEpro.emp.dto.emp009.EmpRsDto009$Company">
        /* selectCompanies */
        WITH RECURSIVE CTE AS (SELECT TEC.COMP_SEQ,
                                      TEC.PARENT_COMP_SEQ,
                                      CAST(TEC.COMP_SEQ AS CHAR(100)) AS COMP_PATH
                               FROM T_EM_COMP TEC
                               WHERE 1 = 1
                                 AND TEC.COMP_SEQ = #{comp.compSeq}

                               UNION ALL

                               SELECT TEC.COMP_SEQ,
                                      TEC.PARENT_COMP_SEQ,
                                      CONCAT(CTE.COMP_PATH, '|', TEC.COMP_SEQ)
                               FROM T_EM_COMP TEC
                                        INNER JOIN CTE CTE
                                                   ON TEC.PARENT_COMP_SEQ = CTE.COMP_SEQ)
        SELECT CTE.COMP_SEQ        AS compSeq,
               CTE.PARENT_COMP_SEQ AS parentCompSeq,
               CTE.COMP_PATH       AS compPath
        FROM CTE
        WHERE 1 = 1
    </select>
</mapper>