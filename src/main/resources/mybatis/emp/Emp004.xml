<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.LightEpro.emp.mapper.EmpMapper004">
    <select id="selectDeptInfoList" resultType="com.example.LightEpro.emp.dto.emp004.EmpRsDto004$DeptInfo">
        /* selectDeptInfoList */
        WITH RECURSIVE CTE AS (SELECT TED.DEPT_SEQ,
                                      TED.PARENT_DEPT_SEQ,
                                      CAST(TED.DEPT_SEQ AS CHAR(100)) AS DEPT_PATH
                               FROM T_EM_DEPT TED
                               WHERE 1 = 1
                                 AND TED.DEPT_SEQ = #{dept.deptSeq}

                               UNION ALL

                               SELECT TED.DEPT_SEQ,
                                      TED.PARENT_DEPT_SEQ,
                                      CONCAT(CTE.DEPT_PATH, '|', TED.DEPT_SEQ)
                               FROM T_EM_DEPT TED
                                        INNER JOIN CTE CTE
                                                   ON TED.PARENT_DEPT_SEQ = CTE.DEPT_SEQ)
        SELECT CTE.DEPT_SEQ        AS deptSeq,
               CTE.PARENT_DEPT_SEQ AS parentDeptSeq,
               CTE.DEPT_PATH       AS deptPath
        FROM CTE
        WHERE 1 = 1
    </select>
</mapper>