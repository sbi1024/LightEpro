<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.LightEpro.sch.mapper.SchMapper005">
    <select id="selectCalendarSequence" resultType="int">
        /* selectCalendarSequence */
        SELECT practice.nextval('cal')
        FROM dual;
    </select>

    <insert id="insertCalendar" parameterType="com.example.LightEpro.sch.dto.sch005.SchRqDto005">
        /* insertCalendar */
        INSERT INTO T_SC_CAL (CAL_SEQ,
                              CAL_TITLE,
                              CAL_CONTENT,
                              CAL_COLOR,
                              CAL_TYPE,
                              USE_YND,
                              CREATE_DATE,
                              CREATE_SEQ)
        VALUES (#{calendar.calSeq},
                #{calendar.calTitle},
                #{calendar.calContent},
                <choose>
                    <when test="calendar.calColor == null or calendar.calColor == ''">
                        '#748FFC'
                    </when>
                    <otherwise>
                        #{calendar.calColor}
                    </otherwise>
                </choose>,
                #{calendar.calType},
                'Y',
                NOW(),
                #{user.userSeq});
    </insert>

    <insert id="insertCalendarOwner" parameterType="com.example.LightEpro.sch.dto.sch005.SchRqDto005">
        /* insertCalendarOwner */
        INSERT INTO T_SC_CAL_USER (CAL_SEQ,
                                   CDE_SEQ,
                                   CDE_TYPE,
                                   CAL_PARTITION_TYPE,
                                   CAL_AUTORITY,
                                   USE_YND,
                                   CREATE_DATE,
                                   CREATE_SEQ)
        VALUES (#{calendar.calSeq},
                #{owner.cdeSeq},
                #{owner.cdeType},
                100,
                'M',
                'Y',
                NOW(),
                #{user.userSeq})
    </insert>

    <insert id="insertCalendarManagers" parameterType="list">
        /* insertCalendarManagers */
        INSERT INTO T_SC_CAL_USER (CAL_SEQ,
                                   CDE_SEQ,
                                   CDE_TYPE,
                                   CAL_PARTITION_TYPE,
                                   CAL_AUTORITY,
                                   USE_YND,
                                   CREATE_DATE,
                                   CREATE_SEQ)
        VALUES <foreach collection="managers" item="manager" separator=",">
                    (
                        #{calendar.calSeq},
                        #{manager.cdeSeq},
                        #{manager.cdeType},
                        200,
                        'W',
                        'Y',
                        NOW(),
                        #{user.userSeq}
                    )
                </foreach>
    </insert>
</mapper>