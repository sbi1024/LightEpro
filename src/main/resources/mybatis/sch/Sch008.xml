<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.LightEpro.sch.mapper.SchMapper008">
    <select id="selectUserCount" resultType="int">
        /* selectUserCount */
        SELECT COUNT(1)
        FROM T_EM_COMP TEC
                 INNER JOIN T_EM_DEPT TED
                            ON TEC.COMP_SEQ = TED.COMP_SEQ
                                AND TEC.USE_YND = 'Y'
                                AND TED.USE_YND = 'Y'
                 INNER JOIN T_EM_EMP TEE
                            ON TED.DEPT_SEQ = TEE.DEPT_SEQ
                                AND TEE.EMP_SEQ = TEE.EMP_SEQ
                                AND TEE.USE_YND = 'Y'
                 INNER JOIN T_EM_EMP_MAPPING TEEM
                            ON TEC.COMP_SEQ = TEEM.COMP_SEQ
                                AND TED.DEPT_SEQ = TEEM.DEPT_SEQ
                                AND TEE.EMP_SEQ = TEEM.EMP_SEQ
                                AND TEEM.USE_YND = 'Y'
                 INNER JOIN T_EM_EMP_ACCOUNT TEEA
                            ON TEEM.EMP_SEQ = TEEA.EMP_SEQ
                                AND TEEA.USE_YND = 'Y'
        WHERE 1 = 1
          AND TEC.COMP_SEQ = #{user.userCompSeq}
          AND TED.DEPT_SEQ = #{user.userDeptSeq}
          AND TEE.EMP_SEQ = #{user.userSeq}
    </select>

    <select id="selectCalendarCount" resultType="int">
        /* selectCalendarCount */
        SELECT COUNT(1)
        FROM T_SC_CAL TSC
        WHERE 1 = 1
          AND TSC.CAL_SEQ = #{calendar.calSeq}
          AND TSC.USE_YND = 'Y'
    </select>

    <update id="updateCalendar">
        /* updateCalendar */
        UPDATE T_SC_CAL TSC
        SET TSC.USE_YND     = 'N',
            TSC.MODIFY_DATE = NOW(),
            TSC.MODIFY_SEQ  = #{user.userSeq}
        WHERE 1 = 1
          AND TSC.CAL_SEQ = #{calendar.calSeq}
          AND TSC.USE_YND = 'Y'
    </update>

    <update id="updateCalendarUsers">
        /* updateCalendarUsers */
        UPDATE T_SC_CAL_USER TSCU
        SET TSCU.USE_YND = 'N',
            TSCU.MODIFY_DATE = NOW(),
            TSCU.MODIFY_SEQ  = #{user.userSeq}
        WHERE 1 = 1
          AND TSCU.CAL_SEQ = #{calendar.calSeq}
          AND TSCU.USE_YND = 'Y'
    </update>

    <update id="updateSchedule">
        /* updateSchedule */
        UPDATE T_SC_SCH TSS
            INNER JOIN (SELECT TSSU.SCHM_SEQ,
                               TSSU.SCH_SEQ
                        FROM T_SC_SCH_USER TSSU
                        WHERE 1 = 1
                          AND TSSU.CAL_SEQ = #{calendar.calSeq}
                          AND TSSU.SCH_PARTITION_TYPE = 10
                          AND TSSU.SCH_AUTHORITY = 'M'
                          AND TSSU.USE_YND = 'Y') AS ADMIN_USER
            ON TSS.SCHM_SEQ = ADMIN_USER.SCHM_SEQ
                AND TSS.SCH_SEQ = ADMIN_USER.SCH_SEQ
        SET TSS.USE_YND     = 'N',
            TSS.MODIFY_DATE = NOW(),
            TSS.MODIFY_SEQ  = #{user.userSeq}
        WHERE 1 = 1
          AND TSS.USE_YND = 'Y'
    </update>

    <update id="updateScheduleUsers">
        /* updateScheduleUsers */
        UPDATE T_SC_SCH_USER TSSU
            INNER JOIN (SELECT TSSU.SCHM_SEQ,
                               TSSU.SCH_SEQ
                        FROM T_SC_SCH_USER TSSU
                        WHERE 1 = 1
                          AND TSSU.CAL_SEQ = #{calendar.calSeq}
                          AND TSSU.SCH_PARTITION_TYPE = 10
                          AND TSSU.SCH_AUTHORITY = 'M'
                          AND TSSU.USE_YND = 'Y') AS ADMIN_USER
            ON TSSU.SCHM_SEQ = ADMIN_USER.SCHM_SEQ
                AND TSSU.SCH_SEQ = ADMIN_USER.SCH_SEQ
        SET TSSU.USE_YND     = 'N',
            TSSU.MODIFY_DATE = NOW(),
            TSSU.MODIFY_SEQ  = #{user.userSeq}
        WHERE 1 = 1
          AND TSSU.USE_YND = 'Y'
    </update>
</mapper>