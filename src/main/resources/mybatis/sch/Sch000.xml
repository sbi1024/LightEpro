<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.LightEpro.sch.mapper.SchMapper000">
    <select id="checkCalType" parameterType="int" resultType="string">
        /* checkCalType */
        SELECT IFNULL(TSC.CAL_TYPE, '') AS calType
        FROM T_SC_CAL TSC
        WHERE 1 = 1
          AND TSC.CAL_SEQ = #{calSeq}
          AND TSC.USE_YND = 'Y'
    </select>

    <select id = "findCurrentSchValue" resultType="int">
        /* findCurrentSchValue */
        SELECT practice.nextval('sch') FROM dual;
    </select>

    <insert id="insertSingleSch" parameterType="com.example.LightEpro.sch.dto.sch000.SchRqDto000">
        /* insertSingleSch */
        INSERT INTO T_SC_SCH (SCHM_SEQ,
                              SCH_SEQ,
                              START_DATE,
                              START_DATE_YEAR,
                              START_DATE_MONTH,
                              END_DATE,
                              END_DATE_YEAR,
                              END_DATE_MONTH,
                              ALL_DAY_YN,
                              SCH_TITLE,
                              SCH_CONTENT,
                              USE_YND,
                              CREATE_DATE,
                              CREATE_SEQ)
        VALUES (#{sch.schmSeq},
                #{sch.schSeq},
                #{sch.startDate},
                #{sch.startDateYear},
                #{sch.startDateMonth},
                #{sch.endDate},
                #{sch.endDateYear},
                #{sch.endDateMonth},
                #{sch.alldayYn},
                #{sch.schTitle},
                #{sch.schContent},
                'Y',
                now(),
                #{user.userSeq})
    </insert>


    <insert id="insertSchParticipants" parameterType="java.util.List">
        /* insertSchParticipants */
        INSERT INTO T_SC_SCH_USER (SCHM_SEQ,
                                   SCH_SEQ,
                                   CDE_SEQ,
                                   CDE_TYPE,
                                   SCH_PARTITION_TYPE,
                                   SCH_AUTORITY,
                                   CAL_SEQ,
                                   USE_YND,
                                   CREATE_DATE,
                                   CREATE_SEQ)
        VALUES <foreach collection="participants" item="participant" separator=",">
                    (
                        #{sch.schmSeq},
                        #{sch.schSeq},
                        #{participant.cdeSeq},
                        #{participant.cdeType},
                        '10',
                        <choose>
                            <when test="participant.cdeSeq == user.userSeq">
                                'M'
                            </when>
                            <otherwise>
                                'W'
                            </otherwise>
                        </choose>,
                        #{participant.calSeq},
                        'Y',
                        now(),
                        #{user.userSeq}
                    )
                </foreach>
    </insert>


    <insert id="insertSchDisclosureScopes" parameterType="java.util.List">
        /* insertSchDisclosureScopes */
        INSERT INTO T_SC_SCH_USER (SCHM_SEQ,
                                   SCH_SEQ,
                                   CDE_SEQ,
                                   CDE_TYPE,
                                   SCH_PARTITION_TYPE,
                                   SCH_AUTORITY,
                                   CAL_SEQ,
                                   USE_YND,
                                   CREATE_DATE,
                                   CREATE_SEQ)
        VALUES <foreach collection="disclosureScopes" item="disclosureScope" separator=",">
                    (
                        #{sch.schmSeq},
                        #{sch.schSeq},
                        #{disclosureScope.cdeSeq},
                        #{disclosureScope.cdeType},
                        '20',
                        'S',
                        #{disclosureScope.calSeq},
                        'Y',
                        now(),
                        #{user.userSeq}
                    )
             </foreach>
    </insert>
</mapper>